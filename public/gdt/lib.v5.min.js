!function(e, n) {
    e.sfetch = n()
}(this, function() {
    return function(e, n) {
        return n = n || {},
            new Promise(function(t, o) {
                    function r() {
                        var e, n = [], t = [], o = {};
                        return s.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm, function(r, s, u) {
                            n.push(s = s.toLowerCase()),
                                t.push([s, u]),
                                e = o[s],
                                o[s] = e ? e + "," + u : u
                        }),
                            {
                                ok: 2 == (s.status / 100 | 0),
                                status: s.status,
                                statusText: s.statusText,
                                url: s.responseURL,
                                clone: r,
                                text: function() {
                                    return Promise.resolve(s.responseText)
                                },
                                json: function() {
                                    return Promise.resolve(s.responseText).then(JSON.parse)
                                },
                                blob: function() {
                                    return Promise.resolve(new Blob([s.response]))
                                },
                                headers: {
                                    keys: function() {
                                        return n
                                    },
                                    entries: function() {
                                        return t
                                    },
                                    get: function(e) {
                                        return o[e.toLowerCase()]
                                    },
                                    has: function(e) {
                                        return e.toLowerCase()in o
                                    }
                                }
                            }
                    }
                    var s = new XMLHttpRequest;
                    s.open(n.method || "get", e, !0);
                    for (var u in n.headers)
                        s.setRequestHeader(u, n.headers[u]);
                    s.withCredentials = "include" == n.credentials,
                        s.onload = function() {
                            t(r())
                        }
                        ,
                        s.onerror = o,
                        s.send(n.body)
                }
            )
    }
});
!function(e, n) {
    "object" == typeof exports && "undefined" != typeof module ? n() : "function" == typeof define && define.amd ? define(n) : n()
}(0, function() {
    "use strict";
    function e(e) {
        var n = this.constructor;
        return this.then(function(t) {
            return n.resolve(e()).then(function() {
                return t
            })
        }, function(t) {
            return n.resolve(e()).then(function() {
                return n.reject(t)
            })
        })
    }
    function n() {}
    function t(e) {
        if (!(this instanceof t))
            throw new TypeError("Promises must be constructed via new");
        if ("function" != typeof e)
            throw new TypeError("not a function");
        this._state = 0,
            this._handled = !1,
            this._value = undefined,
            this._deferreds = [],
            u(e, this)
    }
    function o(e, n) {
        for (; 3 === e._state; )
            e = e._value;
        0 !== e._state ? (e._handled = !0,
            t._immediateFn(function() {
                var t = 1 === e._state ? n.onFulfilled : n.onRejected;
                if (null !== t) {
                    var o;
                    try {
                        o = t(e._value)
                    } catch (f) {
                        return void i(n.promise, f)
                    }
                    r(n.promise, o)
                } else
                    (1 === e._state ? r : i)(n.promise, e._value)
            })) : e._deferreds.push(n)
    }
    function r(e, n) {
        try {
            if (n === e)
                throw new TypeError("A promise cannot be resolved with itself.");
            if (n && ("object" == typeof n || "function" == typeof n)) {
                var o = n.then;
                if (n instanceof t)
                    return e._state = 3,
                        e._value = n,
                        void f(e);
                if ("function" == typeof o)
                    return void u(function(e, n) {
                        return function() {
                            e.apply(n, arguments)
                        }
                    }(o, n), e)
            }
            e._state = 1,
                e._value = n,
                f(e)
        } catch (r) {
            i(e, r)
        }
    }
    function i(e, n) {
        e._state = 2,
            e._value = n,
            f(e)
    }
    function f(e) {
        2 === e._state && 0 === e._deferreds.length && t._immediateFn(function() {
            e._handled || t._unhandledRejectionFn(e._value)
        });
        for (var n = 0, r = e._deferreds.length; r > n; n++)
            o(e, e._deferreds[n]);
        e._deferreds = null
    }
    function u(e, n) {
        var t = !1;
        try {
            e(function(e) {
                t || (t = !0,
                    r(n, e))
            }, function(e) {
                t || (t = !0,
                    i(n, e))
            })
        } catch (o) {
            if (t)
                return;
            t = !0,
                i(n, o)
        }
    }
    var c = setTimeout;
    t.prototype["catch"] = function(e) {
        return this.then(null, e)
    }
        ,
        t.prototype.then = function(e, t) {
            var r = new this.constructor(n);
            return o(this, new function(e, n, t) {
                this.onFulfilled = "function" == typeof e ? e : null,
                    this.onRejected = "function" == typeof n ? n : null,
                    this.promise = t
            }
            (e,t,r)),
                r
        }
        ,
        t.prototype["finally"] = e,
        t.all = function(e) {
            return new t(function(n, t) {
                    function o(e, f) {
                        try {
                            if (f && ("object" == typeof f || "function" == typeof f)) {
                                var u = f.then;
                                if ("function" == typeof u)
                                    return void u.call(f, function(n) {
                                        o(e, n)
                                    }, t)
                            }
                            r[e] = f,
                            0 == --i && n(r)
                        } catch (c) {
                            t(c)
                        }
                    }
                    if (!e || "undefined" == typeof e.length)
                        throw new TypeError("Promise.all accepts an array");
                    var r = Array.prototype.slice.call(e);
                    if (0 === r.length)
                        return n([]);
                    for (var i = r.length, f = 0; r.length > f; f++)
                        o(f, r[f])
                }
            )
        }
        ,
        t.resolve = function(e) {
            return e && "object" == typeof e && e.constructor === t ? e : new t(function(n) {
                    n(e)
                }
            )
        }
        ,
        t.reject = function(e) {
            return new t(function(n, t) {
                    t(e)
                }
            )
        }
        ,
        t.race = function(e) {
            return new t(function(n, t) {
                    for (var o = 0, r = e.length; r > o; o++)
                        e[o].then(n, t)
                }
            )
        }
        ,
        t._immediateFn = "function" == typeof setImmediate && function(e) {
                setImmediate(e)
            }
            || function(e) {
                c(e, 0)
            }
        ,
        t._unhandledRejectionFn = function(e) {
            void 0 !== console && console && console.warn("Possible Unhandled Promise Rejection:", e)
        }
    ;
    var l = function() {
        if ("undefined" != typeof self)
            return self;
        if ("undefined" != typeof window)
            return window;
        if ("undefined" != typeof global)
            return global;
        throw Error("unable to locate global object")
    }();
    "Promise"in l ? l.Promise.prototype["finally"] || (l.Promise.prototype["finally"] = e) : l.Promise = t
});
loadjs = function() {
    var a = function() {}
        , c = {}
        , u = {}
        , f = {};
    function o(e, n) {
        if (e) {
            var t = f[e];
            if (u[e] = n,
                t)
                for (; t.length; )
                    t[0](e, n),
                        t.splice(0, 1)
        }
    }
    function l(e, n) {
        e.call && (e = {
            success: e
        }),
            n.length ? (e.error || a)(n) : (e.success || a)(e)
    }
    function h(t, r, s, i) {
        var c, o, e = document, n = s.async, u = (s.numRetries || 0) + 1, f = s.before || a, l = t.replace(/^(css|img)!/, "");
        i = i || 0,
            /(^css!|\.css$)/.test(t) ? ((o = e.createElement("link")).rel = "stylesheet",
                o.href = l,
            (c = "hideFocus"in o) && o.relList && (c = 0,
                o.rel = "preload",
                o.as = "style")) : /(^img!|\.(png|gif|jpg|svg)$)/.test(t) ? (o = e.createElement("img")).src = l : ((o = e.createElement("script")).src = t,
                o.async = void 0 === n || n),
        !(o.onload = o.onerror = o.onbeforeload = function(e) {
                var n = e.type[0];
                if (c)
                    try {
                        o.sheet.cssText.length || (n = "e")
                    } catch (e) {
                        18 != e.code && (n = "e")
                    }
                if ("e" == n) {
                    if ((i += 1) < u)
                        return h(t, r, s, i)
                } else if ("preload" == o.rel && "style" == o.as)
                    return o.rel = "stylesheet";
                r(t, n, e.defaultPrevented)
            }
        ) !== f(t, o) && e.head.appendChild(o)
    }
    function t(e, n, t) {
        var r, s;
        if (n && n.trim && (r = n),
            s = (r ? t : n) || {},
            r) {
            if (r in c)
                throw "LoadJS";
            c[r] = !0
        }
        function i(n, t) {
            !function(e, r, n) {
                var t, s, i = (e = e.push ? e : [e]).length, c = i, o = [];
                for (t = function(e, n, t) {
                    if ("e" == n && o.push(e),
                    "b" == n) {
                        if (!t)
                            return;
                        o.push(e)
                    }
                    --i || r(o)
                }
                         ,
                         s = 0; s < c; s++)
                    h(e[s], t, n)
            }(e, function(e) {
                l(s, e),
                n && l({
                    success: n,
                    error: t
                }, e),
                    o(r, e)
            }, s)
        }
        if (s.returnPromise)
            return new Promise(i);
        i()
    }
    return t.ready = function(e, n) {
        return function(e, t) {
            e = e.push ? e : [e];
            var n, r, s, i = [], c = e.length, o = c;
            for (n = function(e, n) {
                n.length && i.push(e),
                --o || t(i)
            }
                ; c--; )
                r = e[c],
                    (s = u[r]) ? n(r, s) : (f[r] = f[r] || []).push(n)
        }(e, function(e) {
            l(n, e)
        }),
            t
    }
        ,
        t.done = function(e) {
            o(e, [])
        }
        ,
        t.reset = function() {
            c = {},
                u = {},
                f = {}
        }
        ,
        t.isDefined = function(e) {
            return e in c
        }
        ,
        t
}();
(function() {
        !function(e, t) {
            "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (e = e || self).Aegis = t()
        }(this, function() {
            "use strict";
            var n = function(e, t) {
                return (n = Object.setPrototypeOf || {
                            __proto__: []
                        }instanceof Array && function(e, t) {
                            e.__proto__ = t
                        }
                        || function(e, t) {
                            for (var n in t)
                                t.hasOwnProperty(n) && (e[n] = t[n])
                        }
                )(e, t)
            };
            var s, e, t = {
                version: 1,
                delay: 2e3,
                repeat: 5,
                random: 1,
                url: "https://aegis.qq.com/collect",
                customTimeUrl: "https://aegis.qq.com/speed/custom",
                whiteListUrl: "https://aegis.qq.com/aegis/whitelist"
            }, i = (o.prototype.indexOf = function(e, t) {
                for (var n = 0; n < e.length; n++)
                    if (e[n].callback === t)
                        return n;
                return -1
            }
                ,
                o.prototype.on = function(e, t, n) {
                    if (void 0 === n && (n = 0),
                        this) {
                        var o = this.__EventsList[e];
                        if (o = o || (this.__EventsList[e] = []),
                        -1 !== this.indexOf(o, t))
                            return this;
                        var i = {
                            name: e,
                            type: n || 0,
                            callback: t
                        };
                        return o.push(i),
                            this
                    }
                }
                ,
                o.prototype.one = function(e, t) {
                    this.on(e, t, 1)
                }
                ,
                o.prototype.remove = function(e, t) {
                    if (this) {
                        var n = this.__EventsList[e];
                        if (!n)
                            return null;
                        if (!t) {
                            try {
                                delete this.__EventsList[e]
                            } catch (e) {}
                            return null
                        }
                        if (n.length) {
                            var o = this.indexOf(n, t);
                            n.splice(o, 1)
                        }
                        return this
                    }
                }
                ,
                o);
            function o() {
                var s = this;
                this.emit = function(e, t) {
                    if (s) {
                        var n, o = s.__EventsList[e];
                        if (o && o.length) {
                            o = o.slice();
                            for (var i = 0; i < o.length; i++) {
                                n = o[i];
                                try {
                                    var r = n.callback.apply(s, [t]);
                                    if (1 === n.type && s.remove(e, n.callback),
                                    !1 === r)
                                        break
                                } catch (e) {
                                    throw e
                                }
                            }
                        }
                        return s
                    }
                }
                    ,
                    this.__EventsList = {}
            }
            function r(e) {
                try {
                    return encodeURIComponent(decodeURIComponent(e))
                } catch (e) {
                    return ""
                }
            }
            function a(e) {
                return "string" == typeof e ? e.split("?")[0] : e
            }
            function c(e) {
                return /^https/.test(e)
            }
            function u() {
                return void 0 !== window.performance && "function" == typeof (e = window.Performance) && /native code/.test(e.toString()) && "function" == typeof performance.clearResourceTimings && "function" == typeof performance.getEntriesByType && "function" == typeof performance.now;
                var e
            }
            (e = s = s || {}).INFO_ALL = "-1",
                e.API_RESPONSE = "1",
                e.INFO = "2",
                e.ERROR = "4",
                e.PROMISE_ERROR = "8",
                e.AJAX_ERROR = "16",
                e.SCRIPT_ERROR = "32",
                e.IMAGE_ERROR = "64",
                e.CSS_ERROR = "128",
                e.CONSOLE_ERROR = "256",
                e.MEDIA_ERROR = "512";
            var f = ["application/octet-stream", "application/xhtml+xml", "application/xml", "application/pdf", "application/pkcs12", "application/javascript", "application/ecmascript", "application/vnd.mspowerpoint", "application/ogg", "text/html", "text/css", "text/javascript", "image", "audio", "video"];
            function p(t) {
                return f.some(function(e) {
                    return -1 !== t.indexOf(e)
                })
            }
            function l(e) {
                if ("object" == typeof e && e) {
                    var t = Object.getOwnPropertyNames(e).filter(function(e) {
                        return -1 !== h.indexOf(e.toLowerCase())
                    });
                    return t.length ? e[t[0]] : void 0
                }
            }
            function d(e) {
                try {
                    return (JSON.stringify(e, (o = [],
                            i = [],
                            function(e, t) {
                                if (t instanceof Error)
                                    return t.message && t.stack && -1 === t.stack.indexOf(t.message) ? t.message + " \n " + t.stack : t.stack;
                                if ("object" == typeof t && null !== t) {
                                    var n = o.indexOf(t);
                                    if (-1 !== n)
                                        return "[Circular " + i[n] + "]";
                                    o.push(t),
                                        i.push(e || "root")
                                }
                                return t
                            }
                    ), 4) || "undefined").replace(/"/gim, "")
                } catch (e) {
                    return "error happen when aegis stringify: \n " + e.message + " \n " + e.stack
                }
                var o, i
            }
            var h = ["ret", "retcode"]
                , g = [];
            function m(t) {
                g.forEach(function(e) {
                    e(t)
                })
            }
            var y = !1
                , v = !1
                , w = ["img", "css", "script", "link", "audio", "radio"]
                , _ = [];
            function E(t) {
                _.forEach(function(e) {
                    e(t)
                })
            }
            var R = 0;
            function O() {
                var e, t = performance.getEntriesByType("resource"), n = t.slice(R);
                R = t.length;
                for (var o = 0, i = n.length; o < i; o++) {
                    var r = n[o];
                    -1 !== w.indexOf(r.initiatorType) && E({
                        url: a((e = r).name),
                        method: "get",
                        duration: Number(e.duration.toFixed(2)),
                        status: 200,
                        type: "static",
                        isHttps: c(e.name)
                    })
                }
            }
            var x, S = [];
            function b(e) {
                var t = [];
                for (var n in e)
                    t.push(n + "=" + e[n]);
                S.forEach(function(e) {
                    e({
                        url: "https://aegis.qq.com/speed/performance?" + t.join("&")
                    })
                }),
                    S.length = 0
            }
            var L = []
                , I = ["script", "style", "link", "br"];
            function P(e) {
                if (!e || !e.getBoundingClientRect)
                    return !1;
                var t = e.getBoundingClientRect()
                    , n = window.innerHeight
                    , o = window.innerWidth;
                return 0 <= t.left && t.left < o && 0 <= t.top && t.top < n
            }
            var A = !1
                , T = [];
            function C(t) {
                T.forEach(function(e) {
                    e(t)
                })
            }
            var N = [];
            function j(t) {
                N.forEach(function(e) {
                    e(t)
                })
            }
            var k = !1;
            function M(e) {
                return JSON.stringify({
                    ids: {
                        trace_id: {
                            high: q(),
                            low: q()
                        },
                        span_id: q(),
                        parent_id: 0,
                        flag: 2
                    },
                    baggages: {
                        aegis_session_id: e._sessionID
                    }
                })
            }
            function q() {
                return parseInt(new Array(53).fill(1).map(function() {
                    return .5 < Math.random() ? 1 : 0
                }).join(""), 2)
            }
            function D(e) {
                var t = document.createElement("a");
                return t.href = e,
                location.origin === t.origin
            }
            function H(n) {
                var o, i = [];
                return function(e, t) {
                    i.push(e),
                    o && clearTimeout(o),
                        o = setTimeout(function() {
                            o = null,
                                t(i.splice(0, i.length))
                        }, n)
                }
            }
            function J(e, t) {
                return Array.isArray(e) ? t(e.map(function(e) {
                    return {
                        msg: "string" == typeof e.msg ? e.msg : d(e.msg),
                        level: e.level
                    }
                })) : t({
                    msg: "string" == typeof e.msg ? e.msg : d(e.msg),
                    level: e.level
                })
            }
            var F = function() {};
            function X(n) {
                if (!n || !n.reduce || !n.length)
                    throw new TypeError("createPipeline 鏂规硶闇€瑕佷紶鍏ヨ嚦灏戞湁涓€涓� pipe 鐨勬暟缁�");
                return 1 === n.length ? function(e, t) {
                        n[0](e, t || F)
                    }
                    : n.reduce(function(n, o) {
                        return function(e, t) {
                            return void 0 === t && (t = F),
                                n(e, function(e) {
                                    return o && o(e, t)
                                })
                        }
                    })
            }
            var B = (U.prototype.init = function(e, t) {
                var n = this;
                this.setConfig(e),
                    U.installedPlugins.forEach(function(e) {
                        e.call(n, t)
                    }),
                    this.lifeCycle.emit("onInited")
            }
                ,
                U.prototype.setConfig = function(e) {
                    return Object.assign(this.config, e),
                        this.bean.id = this.config.id || "",
                        this.bean.uin = this.config.uin || "",
                        this.config
                }
                ,
                U.use = function(e) {
                    -1 === U.installedPlugins.indexOf(e) && U.installedPlugins.push(e)
                }
                ,
                U.prototype.send = function(e, t, n) {
                    throw new Error('You need to override "send" method')
                }
                ,
                U.prototype._sendSDKError = function(e) {
                    this.send({
                        url: "https://aegis.qq.com/collect?id=1085&msg[0]=" + encodeURIComponent(d(e)) + "&level[0]=2&from=" + this.config.id + "&count=1&version=1.0.0",
                        addBean: !1,
                        method: "get"
                    })
                }
                ,
                U.prototype.info = function(e) {
                    this._normalLogPipeline({
                        msg: e,
                        level: s.INFO
                    })
                }
                ,
                U.prototype.infoAll = function(e) {
                    this._normalLogPipeline({
                        msg: e,
                        level: s.INFO_ALL
                    })
                }
                ,
                U.prototype.report = function(e) {
                    this._normalLogPipeline({
                        msg: e,
                        level: s.ERROR
                    })
                }
                ,
                U.prototype.reportPv = function(e) {
                    e && this.send({
                        url: this.config.url + "/" + e
                    })
                }
                ,
                U.prototype.reportTime = function(e, t) {
                    "string" == typeof e ? "number" == typeof t ? this._submitCustomTime(e, t) : console.warn("reportTime 鐨勭浜屼釜鍙傛暟蹇呴』涓� number 绫诲瀷鍝�") : console.warn("reportTime 鐨勭涓€涓弬鏁板繀椤讳负寮€鍙戣€呭钩鍙扮敵璇风殑 key 鍊�")
                }
                ,
                U.prototype.time = function(e) {
                    "string" == typeof e ? this._timeMap[e] ? console.warn("Timer " + e + " already exists") : this._timeMap[e] = Date.now() : console.warn("time 鐨勭涓€涓弬鏁板繀椤讳紶鍏ュ紑鍙戣€呭钩鍙扮敵璇峰埌鐨� key 鍊�")
                }
                ,
                U.prototype.timeEnd = function(e) {
                    "string" == typeof e ? this._timeMap[e] ? (this._submitCustomTime(e, Date.now() - this._timeMap[e]),
                        delete this._timeMap[e]) : console.warn("Timer " + e + " does not exist") : console.warn("timeEnd 鐨勭涓€涓弬鏁板繀椤讳紶鍏ュ紑鍙戣€呭钩鍙扮敵璇峰埌鐨� key 鍊�")
                }
                ,
                U.prototype._submitCustomTime = function(e, t) {
                    this._customTimePipeline({
                        name: e,
                        duration: t
                    })
                }
                ,
                U.installedPlugins = [],
                U);
            function U(e) {
                var o = this;
                this.config = t,
                    this.lifeCycle = new i,
                    this.bean = {},
                    this._normalLogPipeline = X([H(this.config.delay), function(e) {
                        var o = !1
                            , i = !1;
                        setTimeout(function() {
                            e.send({
                                url: e.config.whiteListUrl
                            }, function(e) {
                                try {
                                    0 === (e = JSON.parse(e) || {}).retcode && (o = e.result.is_in_white_list),
                                        i = !0
                                } catch (e) {}
                            }, function() {
                                i = !0
                            })
                        }, 50);
                        var r = [];
                        return function(e, t) {
                            if (o)
                                t(e.concat(r.splice(0)).map(function(e) {
                                    return e.level === s.INFO_ALL && (e.level = s.INFO),
                                        e
                                }));
                            else {
                                var n = e.filter(function(e) {
                                    if (e.level !== s.INFO && e.level !== s.API_RESPONSE)
                                        return e.level === s.INFO_ALL && (e.level = s.INFO),
                                            !0;
                                    i || (r.push(e),
                                    200 <= r.length && (r.length = 200))
                                });
                                n.length && t(n)
                            }
                        }
                    }(this), J, function(e, t) {
                        var n = o.config.beforeReport;
                        if ("function" == typeof n && (e = e.filter(function(e) {
                            return !1 !== n(e)
                        })),
                            e.length)
                            return o.lifeCycle.emit("beforeReport", e),
                                t(e)
                    }
                        , function(e) {
                            o.send({
                                url: o.config.url,
                                data: function(e) {
                                    return (e = Array.isArray(e) ? e : [e]).map(function(t, n) {
                                        return Object.getOwnPropertyNames(t).map(function(e) {
                                            return r(e) + "[" + n + "]=" + r(t[e])
                                        }).join("&")
                                    }).join("&") + (e.length ? "&count=" + e.length : "")
                                }(e),
                                method: "post",
                                contentType: "application/x-www-form-urlencoded"
                            }, function() {
                                var t = o.config.onReport;
                                "function" == typeof t && e.forEach(function(e) {
                                    t(e)
                                })
                            })
                        }
                    ]),
                    this._timeMap = {},
                    this._customTimePipeline = X([H(this.config.delay), function(e) {
                        o.send({
                            url: o.config.customTimeUrl + "?version=" + o.config.version + "&payload=" + encodeURIComponent(JSON.stringify({
                                custom: e
                            }))
                        })
                    }
                    ])
            }
            var G, K, W, Y = (n(K = z, W = G = B),
                K.prototype = null === W ? Object.create(W) : (Q.prototype = W.prototype,
                    new Q),
                Object.defineProperty(z.prototype, "_bean", {
                    get: function() {
                        var t = this;
                        return Object.getOwnPropertyNames(this.bean).map(function(e) {
                            return e + "=" + t.bean[e]
                        }).join("&")
                    },
                    enumerable: !0,
                    configurable: !0
                }),
                z.useAsyncPlugin = function(n, e) {
                    void 0 === e && (e = {});
                    var t = e.exportsConstructor
                        , o = void 0 === t ? "aegis-plugin-" + String(Math.random()).slice(3, 12) : t
                        , i = e.onAegisInit
                        , r = void 0 === i ? function() {}
                        : i
                        , s = e.onAegisInitAndPluginLoaded
                        , a = void 0 === s ? function() {}
                        : s;
                    if ("string" != typeof n)
                        throw new TypeError("寮傛鎻掍欢鐨� url 蹇呴』鏄� string 绫诲瀷");
                    if ("function" != typeof r || "function" != typeof a)
                        throw new TypeError("onAegisInit銆乷nAegisInitAndPluginLoaded閮藉繀椤绘槸鍑芥暟");
                    this.use(function() {
                        var e = this;
                        try {
                            if (r(this),
                                z._asyncPlugin[n])
                                a(this, window[z._asyncPlugin[n]]);
                            else {
                                var t = document.createElement("script");
                                t.src = n,
                                    t.async = !0,
                                    t.setAttribute("name", o),
                                    t.onload = function() {
                                        z._asyncPlugin[n] = o,
                                            a(e, window[o])
                                    }
                                    ,
                                    t.onerror = function() {
                                        z._asyncPlugin[n] = ""
                                    }
                                    ,
                                    document.head.appendChild(t)
                            }
                        } catch (e) {
                            console.log("鍦ㄥ垵濮嬪寲鎻掍欢 " + n + " 鏃跺彂鐢熶互涓嬮敊璇細"),
                                console.error(e)
                        }
                    })
                }
                ,
                z.__version__ = "1.0.0",
                z._sessionID = "session-" + Date.now(),
                z._asyncPlugin = {},
                z);
            function z(e) {
                var o, s = G.call(this, e) || this;
                s.send = function(e, t, n) {
                    if (e && "string" == typeof e.url) {
                        var o = e.url;
                        !1 !== e.addBean && (o = o + (-1 === o.indexOf("?") ? "?" : "&") + s._bean);
                        var i = e.method || "get"
                            , r = new XMLHttpRequest;
                        r.__sendByAegis = !0,
                            r.addEventListener("readystatechange", function() {
                                4 === r.readyState && (400 <= r.status ? n && n(r.response) : t && t(r.response))
                            }),
                            "get" === i.toLocaleLowerCase() ? (r.open("get", function(e, n) {
                                if ("string" != typeof e)
                                    return "";
                                if ("object" == typeof n && n) {
                                    var t = Object.getOwnPropertyNames(n).map(function(e) {
                                        var t = n[e];
                                        return e + "=" + ("string" == typeof t ? encodeURIComponent(t) : encodeURIComponent(JSON.stringify(t)))
                                    }).join("&");
                                    return e + (-1 === e.indexOf("?") ? "?" : "&") + t
                                }
                                return e
                            }(o, e.data)),
                                r.send()) : (r.open("post", o),
                            e.contentType && r.setRequestHeader("Content-Type", e.contentType),
                                r.send(e.data))
                    }
                }
                    ,
                    s._speedLogPipeline = X([(o = {},
                            function(e, t) {
                                if (Array.isArray(e)) {
                                    var n = e.filter(function(e) {
                                        var t = !o[e.url];
                                        return o[e.url] = !0,
                                            t
                                    });
                                    n.length && t(n)
                                } else
                                    o[e.url] || t(e),
                                        o[e.url] = !0
                            }
                    ), H(s.config.delay), function(e, t) {
                        var n = s.config.beforeReportSpeed;
                        if ("function" == typeof n && (e = e.filter(function(e) {
                            return !1 !== n(e)
                        })),
                            e.length)
                            return s.lifeCycle.emit("beforeReportSpeed", e),
                                t(e)
                    }
                        , function(e) {
                            s.send({
                                url: "https://aegis.qq.com/speed",
                                method: "post",
                                data: function(e, t) {
                                    var n = {
                                        fetch: [],
                                        static: []
                                    }
                                        , o = new FormData;
                                    return Array.isArray(e) ? e.forEach(function(e) {
                                        n[e.type].push(e)
                                    }) : n[e.type].push(e),
                                        o.append("payload", JSON.stringify(Object.assign({
                                            duration: n
                                        }, t))),
                                        o
                                }(e, s.bean)
                            })
                        }
                    ]);
                try {
                    s.init(e, z),
                        s.bean.sessionId = z._sessionID
                } catch (e) {
                    console.warn(e),
                        console.log("%c浠ヤ笂閿欒鍙戠敓鍦ㄥ垵濮嬪寲 Aegis 鐨勮繃绋嬩腑锛屽皢浼氬奖鍝嶆偍姝ｅ父浣跨敤 Aegis锛孿n寤鸿鎮ㄨ仈绯� aegis-helper锛岃繘琛屽弽棣堬紝鎰熻阿鎮ㄧ殑鏀寔銆�", "color: red"),
                        s._sendSDKError(e)
                }
                return s
            }
            function Q() {
                this.constructor = K
            }
            return Y.use(function() {
                g.push(this._normalLogPipeline),
                    function() {
                        if (!y) {
                            y = !0;
                            var n = window.onerror;
                            window.onerror = function() {
                                for (var e = [], t = 0; t < arguments.length; t++)
                                    e[t] = arguments[t];
                                e[4] && m({
                                    msg: e[4],
                                    level: s.ERROR
                                }),
                                n && n.call.apply(n, function() {
                                    for (var e = 0, t = 0, n = arguments.length; t < n; t++)
                                        e += arguments[t].length;
                                    var o = Array(e)
                                        , i = 0;
                                    for (t = 0; t < n; t++)
                                        for (var r = arguments[t], s = 0, a = r.length; s < a; s++,
                                            i++)
                                            o[i] = r[s];
                                    return o
                                }([window], e))
                            }
                                ,
                                window.addEventListener("unhandledrejection", function(e) {
                                    m({
                                        msg: "PROMISE_ERROR: " + (e && d(e.reason)),
                                        level: s.PROMISE_ERROR
                                    })
                                }),
                                window.document.addEventListener("error", function(e) {
                                    if (e && e.target && e.srcElement) {
                                        var t = e.target || e.srcElement
                                            , n = t.src || t.href
                                            , o = t.tagName;
                                        if (n && o) {
                                            var i = {
                                                msg: o + " load fail: " + n,
                                                level: s.INFO
                                            };
                                            switch (o.toLowerCase()) {
                                                case "script":
                                                    i.level = s.SCRIPT_ERROR;
                                                    break;
                                                case "link":
                                                    i.level = s.CSS_ERROR;
                                                    break;
                                                case "img":
                                                    i.level = s.IMAGE_ERROR;
                                                    break;
                                                case "audio":
                                                case "video":
                                                    i.level = s.MEDIA_ERROR
                                            }
                                            m(i)
                                        }
                                    }
                                }, !0)
                        }
                    }()
            }),
                Y.use(function() {
                    var e, t, n;
                    this.config.reportApiSpeed && (T.push(this._speedLogPipeline),
                        N.push(this._normalLogPipeline),
                    A || (A = !0,
                            function() {
                                if ("function" == typeof window.fetch) {
                                    var e = window.fetch;
                                    window.fetch = function(o, i) {
                                        var r = Date.now();
                                        return e(o, i).then(function(n) {
                                            try {
                                                var e = n.headers ? n.headers.get("content-type") : "";
                                                n.ok && "string" == typeof e && p(e) ? C({
                                                    url: a(n.url),
                                                    isHttps: c(n.url),
                                                    method: i && i.method || "get",
                                                    duration: Date.now() - r,
                                                    type: "static",
                                                    status: n.status
                                                }) : n.clone().text().then(function(e) {
                                                    var t;
                                                    j({
                                                        msg: o + " " + e,
                                                        level: s.API_RESPONSE
                                                    });
                                                    try {
                                                        t = l(JSON.parse(e))
                                                    } catch (e) {}
                                                    C({
                                                        url: a(n.url),
                                                        isHttps: c(n.url),
                                                        method: i && i.method || "get",
                                                        duration: Date.now() - r,
                                                        type: "fetch",
                                                        ret: t || "unknown",
                                                        status: n.status
                                                    })
                                                })
                                            } catch (n) {}
                                            return n
                                        }).catch(function(e) {
                                            throw C({
                                                url: a(o),
                                                isHttps: c(o),
                                                method: i && i.method || "get",
                                                duration: Date.now() - r,
                                                type: "fetch",
                                                status: 600
                                            }),
                                                e
                                        })
                                    }
                                }
                            }(),
                            e = window.XMLHttpRequest.prototype,
                            t = e.open,
                            n = e.send,
                            e.open = function() {
                                return this.__sendByAegis || (this.aegisMethod = arguments[0]),
                                    t.apply(this, arguments)
                            }
                            ,
                            e.send = function() {
                                var o = Date.now();
                                return this.__sendByAegis || this.addEventListener("loadend", function() {
                                    var e = this.responseURL
                                        , t = {
                                        url: a(e),
                                        isHttps: c(e),
                                        status: this.status,
                                        method: this.aegisMethod || "get",
                                        type: "fetch",
                                        duration: Date.now() - o
                                    }
                                        , n = this.getResponseHeader("content-type");
                                    if (400 <= this.status || "string" != typeof n || !p(n))
                                        try {
                                            j({
                                                msg: e + " " + this.response,
                                                level: s.API_RESPONSE
                                            }),
                                                t.ret = l(JSON.parse(this.response))
                                        } catch (e) {
                                            t.ret = "unknown"
                                        }
                                    else
                                        t.type = "static",
                                            delete t.ret;
                                    C(t)
                                }),
                                    n.apply(this, arguments)
                            }
                    ))
                }),
                Y.use(function() {
                    u() && this.config.reportAssetSpeed && (_.push(this._speedLogPipeline),
                    v || (v = !0,
                        setInterval(O, this.config.delay),
                        performance.onresourcetimingbufferfull = function() {
                            R = 0,
                                performance.clearResourceTimings()
                        }
                        ,
                        window.document.addEventListener("error", function(e) {
                            if (e && e.target && e.srcElement) {
                                var t = e.target || e.srcElement
                                    , n = t.src || t.href;
                                n && E({
                                    url: a(n),
                                    status: 400,
                                    method: "get",
                                    type: "static",
                                    isHttps: c(n)
                                })
                            }
                        }, !0)))
                }),
                Y.use(function() {
                    var e, o;
                    S.push(this.send),
                        x ? b(x) : (e = function(e) {
                            var t = performance.timing;
                            b(x = {
                                dnsLookup: t.domainLookupEnd - t.domainLookupStart,
                                tcp: t.connectEnd - t.connectStart,
                                ssl: 0 === t.secureConnectionStart ? 0 : t.requestStart - t.secureConnectionStart,
                                ttfb: t.responseStart - t.requestStart,
                                contentDownload: t.responseEnd - t.responseStart,
                                domParse: t.domInteractive - t.domLoading,
                                resourceDownload: t.loadEventStart - t.domInteractive,
                                firstScreenTiming: Math.floor(e)
                            })
                        }
                            ,
                            (o = new MutationObserver(function(e) {
                                    if (e && e.forEach) {
                                        var t = {
                                            time: performance.now(),
                                            roots: []
                                        };
                                        e.forEach(function(e) {
                                            e && e.addedNodes && e.addedNodes.forEach && e.addedNodes.forEach(function(e) {
                                                1 === e.nodeType && -1 === I.indexOf(e.nodeName.toLocaleLowerCase()) && (function e(t, n) {
                                                    return !(!t || t === document.documentElement) && (-1 !== n.indexOf(t) || e(t.parentElement, n))
                                                }(e, t.roots) || t.roots.push(e))
                                            })
                                        }),
                                        t.roots.length && L.push(t)
                                    }
                                }
                            )).observe(document, {
                                childList: !0,
                                subtree: !0
                            }),
                            setTimeout(function() {
                                o.disconnect();
                                var n = NaN
                                    , t = !1;
                                L.forEach(function(e) {
                                    for (var t = 0; t < e.roots.length; t++)
                                        if (P(e.roots[t])) {
                                            n = e.time;
                                            break
                                        }
                                }),
                                u() && window.performance.getEntriesByType("resource").forEach(function(e) {
                                    "img" === e.initiatorType && (e.fetchStart < n || e.startTime < n) && e.responseEnd > n && (t = !0,
                                        n = e.responseEnd)
                                }),
                                    e(t ? n : n + 25)
                            }, 5e3))
                }),
                Y.use(function() {
                    var t = this;
                    !function(e) {
                        try {
                            var t = window.localStorage.getItem("AEGIS_ID");
                            t || (t = "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function(e) {
                                var t = 16 * Math.random() | 0;
                                return ("x" == e ? t : 3 & t | 8).toString(16)
                            }),
                                window.localStorage.setItem("AEGIS_ID", t)),
                                e(t || "")
                        } catch (t) {
                            e("")
                        }
                    }(function(e) {
                        t.bean.aid = e
                    })
                }),
                Y.use(function(e) {
                    var t;
                    this.config.tjg && (t = e,
                    k || (k = !0,
                        function(n) {
                            if ("function" == typeof window.fetch) {
                                var o = window.fetch;
                                window.fetch = function(e, t) {
                                    return D(e) && ("object" == typeof t && t ? t.headers ? t.headers instanceof Headers && t.headers.append("X-Tjg-Json-Span-Context", M(n)) : t.headers = new Headers({
                                        "X-Tjg-Json-Span-Context": M(n)
                                    }) : t = {
                                        headers: new Headers({
                                            "X-Tjg-Json-Span-Context": M(n)
                                        })
                                    }),
                                        o(e, t)
                                }
                            }
                        }(t),
                        function(e) {
                            if (window.XMLHttpRequest) {
                                var t = window.XMLHttpRequest.prototype.send
                                    , n = window.XMLHttpRequest.prototype.open;
                                window.XMLHttpRequest.prototype.open = function() {
                                    return !this.__sendByAegis && D(arguments[1]) && (this.useTjg = !0),
                                        n.apply(this, arguments)
                                }
                                    ,
                                    window.XMLHttpRequest.prototype.send = function() {
                                        return this.useTjg && this.setRequestHeader("X-Tjg-Json-Span-Context", M(e)),
                                            t.apply(this, arguments)
                                    }
                            }
                        }(t)))
                }),
                Y
        });
    }
)();

(function() {
        if (window.Aegis) {
            window.aegis = new Aegis({
                id: 999,
                // 项目ID
                repeat: 1,
                random: 0.03,
                reportApiSpeed: true,
                // 接口测速
                reportAssetSpeed: true,
                // 静态资源测速
            })
        }
    }
)();
