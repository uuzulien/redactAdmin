function CheckAll(t) {
    console.log(t);
    for (var i = 0; i < t.elements.length; i++) {
        var e = t.elements[i];
        "chkall" != e.name && (e.checked = t.chkall.checked)
    }
}
function getCheckAllData() {
    var t = "";
    return $("#formlist [name='ids']:checked").each(function() {
        t += "" != t ? "," : "",
            t += $(this).val()
    }),
        t
}
$(function() {
    toastr.options.positionClass = "toast-top-center",
        $('[data-toggle="tooltip"]').tooltip()
});
var noticemsg = new function() {
        var e = "notice_msg"
            , o = -1;
        function a(t) {
            t = 9 <= t ? "9+" : t,
                $(".notice_msgnum").text(t)
        }
        this.showmsgnumEx = function(t) {
            0 < t && (a(t),
                $("#noticemenu").css("color", "#E85656"))
        }
            ,
            this.showmsgnum = function(t) {
                var i = Cookies.get(e);
                i ? 0 < (i = t - parseInt(i)) && a(i) : a(t)
            }
            ,
            this.setmsgnum = function() {
                Cookies.set(e, _Notice, {
                    expires: 31536e4
                })
            }
            ,
            this.autoreaddlg = function() {
                !function a() {
                    var t = _unReadTop.length;
                    if (t <= 0 && t <= o)
                        return;
                    var i = _unReadTop[++o];
                    try {
                        sendData("/notice/api?action=content&msgid=" + i, {}, function(t) {
                            if ("error" != t && "0" == t.err) {
                                var i = t.data
                                    , e = Ewin.dialog({
                                    title: i.title,
                                    message: i.content,
                                    btnok: "我知道了",
                                    isbtncl: !1
                                });
                                e.on(function(t) {
                                    a()
                                })
                            }
                        })
                    } catch (t) {}
                }()
            }
    }
    , api = new function() {
        this.showtip = function(t) {
            $("#tipdlg").html('<div class="alert alert-warning alert-dismissible" role="alert" ><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><i class="fa fa-exclamation-triangle" aria-hidden="true"></i>' + t + "</div>")
        }
            ,
            this.submitStatus = function(t, i, e) {
                t ? (e = e || "",
                    $(i).attr({
                        disabled: "disabled"
                    }).html('<i class="fa fa-spinner fa-spin"></i>' + e)) : $(i).removeAttr("disabled").html(e)
            }
            ,
            this.GetRandomNum = function(t, i) {
                var e = i - t
                    , a = Math.random();
                return t + Math.round(a * e)
            }
            ,
            this.TextToHtml = function(t) {
                return t ? t = (t = t.replace(/((http|https):\/\/[^\s]+)/g, function(t) {
                    return '<a href="' + t + '" target="_blank">' + t + "</a>"
                })).replace(/\n/g, "<br/>") : t
            }
            ,
            this.CopyText_modal = function() {
                new Clipboard(".btn-copy-url",{
                    text: function() {
                        return $(".text-copy-url").text()
                    }
                }).on("success", function(t) {
                    t.clearSelection(),
                        toastr.success("推广链接复制成功")
                })
            }
            ,
            this.CopyText_footbar = function() {
                new Clipboard(".foot-btn-copy-url",{
                    text: function() {
                        return $(".foot-text-copy-url").text()
                    }
                }).on("success", function(t) {
                    t.clearSelection(),
                        toastr.success("推广链接复制成功")
                })
            }
    }
;
function sendData(t, i, a) {
    $.ajax({
        type: "POST",
        url: t,
        data: i,
        dataType: "json",
        success: function(t) {
            try {
                a(t)
            } catch (t) {
                console.log(t),
                    a("error")
            }
            return !1
        },
        error: function(t, i, e) {
            a("error")
        }
    })
}
function getDispatchFollow(i, t) {
    var e = $(i).val();
    "" != e ? sendData("/dispatch/api", {
        action: "getfollowtext",
        aid: t,
        num: e
    }, function(t) {
        if ("error" != t)
            return t.err < 0 ? (toastr.warning(t.msg),
                $(i).val(""),
                void $(i).next().text("")) : void (0 == t.err && $(i).next().text(t.data.text));
        toastr.error("网络繁忙，请稍候再试")
    }) : $(i).next().text("")
}
function submitDispatch(t, e, i, a) {
    var o = Ewin.dialog({
        btnok: 0 < e ? "保存修改" : "保存创建",
        title: 0 < e ? "修改属性" : "创建推广链接",
        message: '<div style="text-align:center"><i class="fa fa-spinner fa-spin" style="font-size: 46px;margin:0 auto;"></i></div>',
        url: "/dispatch/widget?type=" + t + "&did=" + e + "&aid=" + i + "&num=" + a
    });
    $("#" + o.id).off().on("hidden", "hidden.bs.modal"),
        o.on(function(t) {
            if (t) {
                try {
                    __cfg && 0 == e && ($("#title_id").val(__cfg.title),
                        $("#cover_id").val(__cfg.cover),
                        $("#body_id").val(__cfg.body),
                        $("#footer_id").val(__cfg.footer))
                } catch (t) {
                    console.log(t)
                }
                var i = $("#dispatch-form").serialize();
                sendData("/dispatch/api", i += "&action=save", function(t) {
                    "error" != t ? 0 == t.err ? ($("#" + o.id).remove(),
                        $(".modal-backdrop").remove(),
                        $("body").removeClass("modal-open").removeAttr("style"),
                        showResultDlg(t.data.url, e, t.data.did, "dispatch")) : toastr.warning(t.msg) : toastr.error("网络繁忙，请稍候再试")
                })
            } else
                $("#" + o.id).remove(),
                    $(".modal-backdrop").remove(),
                    $("body").removeClass("modal-open").removeAttr("style");
            return !0
        })
}
function submitInDispatch(t, e, i, a) {
    var o = Ewin.dialog({
        btnok: 0 < e ? "保存修改" : "保存创建",
        title: 0 < e ? "修改属性" : "创建内推链接",
        message: '<div style="text-align:center"><i class="fa fa-spinner fa-spin" style="font-size: 46px;margin:0 auto;"></i></div>',
        url: "/idispatch/widget?type=" + t + "&did=" + e + "&aid=" + i + "&num=" + a
    });
    $("#" + o.id).off().on("hidden", "hidden.bs.modal"),
        o.on(function(t) {
            if (t) {
                try {
                    __cfg && 0 == e && ($("#title_id").val(__cfg.title),
                        $("#cover_id").val(__cfg.cover),
                        $("#body_id").val(__cfg.body),
                        $("#footer_id").val(__cfg.footer))
                } catch (t) {
                    console.log(t)
                }
                var i = $("#dispatch-form").serialize();
                sendData("/idispatch/api", i += "&action=save", function(t) {
                    "error" != t ? 0 == t.err ? ($("#" + o.id).remove(),
                        $(".modal-backdrop").remove(),
                        $("body").removeClass("modal-open").removeAttr("style"),
                        showResultDlg(t.data.url, e, t.data.did, "idispatch")) : toastr.warning(t.msg) : toastr.error("网络繁忙，请稍候再试")
                })
            } else
                $("#" + o.id).remove(),
                    $(".modal-backdrop").remove(),
                    $("body").removeClass("modal-open").removeAttr("style");
            return !0
        })
}
function showResultDlg(t, i, e, a) {
    var o = '<div style="font-size:16px;"><div>请复制下方推广链接，您可以在后台菜单的"推广链接"中找到它并查看统计数据</div><div style="margin:10px 0" class="text-success text-copy-url">' + t + '</div><div style="color:red;"><i class="fa fa-info-circle"></i> 请使用此链接作为文案的原文链接地址</div></div>'
        , n = Ewin.dialog({
        btnok: "复制推广链接",
        isbtncl: !1,
        title: "保存成功",
        message: o
    });
    $("#" + n.id).find(".ok").addClass("btn-copy-url"),
        $("#" + n.id).off().on("hidden", "hidden.bs.modal"),
        n.on(function(t) {
            if (t)
                ;
            else {
                if (i == e)
                    $("#" + n.id).remove(),
                        $(".modal-backdrop").remove(),
                        $("body").removeClass("modal-open").removeAttr("style");
                else {
                    if ("/wxeditor/view" == location.pathname)
                        return void (window.location.href = "/wxeditor/view?did=" + e);
                    if ("/wxeditor/in-view" == location.pathname)
                        return void (window.location.href = "/wxeditor/in-view?did=" + e)
                }
                if ("/dispatch/list" == location.pathname)
                    return void window.location.reload();
                if ("/idispatch/list" == location.pathname)
                    return void window.location.reload();
                if ("/article/view" == location.pathname)
                    return void (window.location.href = "/dispatch/list");
                if ("/article/in-view" == location.pathname)
                    return void (window.location.href = "/idispatch/list")
            }
        })
}
function selectQrcode(t, a, i, e) {
    var o = t
        , n = i
        , s = e;
    function d(t) {
        t = null == t ? '<i class="fa fa-spin fa-spinner" style="font-size:48px;"></i>' : t,
            $("#" + o).find(".qrcode-preview").html(t).show()
    }
    this.init = function() {
        var t = '\x3c!--图片选择框--\x3e    <style type="text/css">    #' + o + " .select-box{margin:0 -15px;}    #" + o + " .select-box ul{padding:0px;display: flex;flex-wrap: wrap;justify-content:space-around;}    #" + o + " .select-box ul>li{cursor:pointer; width: 110px;height: 60px;list-style: none;margin-bottom: 10px;margin-right: 10px;border: 2px solid #ccc;}    #" + o + " .select-box ul>li:first-child{text-align: center;line-height: 56px;}    #" + o + " .select-box ul .curr{border:2px solid #00AAFF;}    #" + o + " .select-box ul>li img{width:100%; height:100%;}    #" + o + " .qrcode-preview{padding-top:20px;text-align: center; display: none;}    #" + o + ' .qrcode-preview img{max-width: 568px;}    </style>    <div id="' + o + '" data-linkid="0" class="modal fade" role="dialog" aria-labelledby="modalLabel" style="z-index: 2000">      <div class="modal-dialog">        <div class="modal-content">          <div class="modal-header">            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>            <h4 class="modal-title" id="modalLabel">选择下载二维码图</h4>          </div>          <div class="modal-body">            <div class="select-box">                <ul>                    <li data-index="0">二维码原图</li>                    <li data-index="1"><a href="javascript:;"><img src="' + s + 's/qrcode/thumb/1.jpg"></a></li>                    <li data-index="2"><a href="javascript:;"><img src="' + s + 's/qrcode/thumb/2.jpg"></a></li>                    <li data-index="3"><a href="javascript:;"><img src="' + s + 's/qrcode/thumb/3.jpg"></a></li>                    <li data-index="4"><a href="javascript:;"><img src="' + s + 's/qrcode/thumb/4.jpg"></a></li>                    <li data-index="5"><a href="javascript:;"><img src="' + s + 's/qrcode/thumb/5.jpg"></a></li>                    <li data-index="6"><a href="javascript:;"><img src="' + s + 's/qrcode/thumb/6.jpg"></a></li>                    <li data-index="7"><a href="javascript:;"><img src="' + s + 's/qrcode/thumb/7.jpg"></a></li>                </ul>            </div>            <div class="qrcode-preview"></div>          </div>        </div>      </div>    </div>    \x3c!--图片选择框-END--\x3e';
        $("body").append(t);
        var e = this;
        $("." + a).bind("click", function(t) {
            t.stopPropagation();
            var i = $(this).attr("data-linkid");
            e.show(i)
        }),
            $("#" + o).find(".select-box li").bind("click", function(t) {
                event.stopPropagation();
                var i = $("#" + o).attr("data-linkid")
                    , e = $(this).data("index");
                d(),
                    sendData("/" + n + "/api", {
                        action: a,
                        linkid: i,
                        tempid: e
                    }, function(t) {
                        d(""),
                            "error" != t ? 0 == t.err ? 0 == t.err && function(t, i, e) {
                                $("#" + o).find(".qrcode-preview").html('<a href="' + t + '"  download="qrcode_' + i + "_" + e + '"><img src="' + t + '"></a>')
                            }(s + t.data.url, t.data.linkid, t.data.tempid) : toastr.warning(t.msg) : toastr.error("网络繁忙，请稍候再试")
                    }),
                    $(this).siblings().removeClass("curr"),
                    $(this).addClass("curr")
            })
    }
        ,
        this.show = function(t) {
            $("#" + o).attr("data-linkid", t),
                $("#" + o).find(".select-box .curr").removeClass("curr"),
                d(""),
                $("#" + o).modal("show")
        }
        ,
        this.hide = function() {
            $("#" + o).modal("hide")
        }
}
!function(o) {
    function a(e) {
        e = o.extend({}, {
            title: "操作提示",
            message: "提示内容",
            btnok: "确定",
            btncl: "取消",
            isbtnok: !0,
            isbtncl: !0,
            width: 200,
            auto: !1
        }, e || {});
        var a = "mdl" + (new Date).valueOf()
            , t = n.replace(s, function(t, i) {
            return {
                Id: a,
                Title: e.title,
                Message: e.message,
                BtnOk: e.btnok,
                BtnCancel: e.btncl
            }[i]
        });
        o("body").append(t);
        var i = o("#" + a);
        return i.modal({
            width: e.width,
            backdrop: "static"
        }),
            i.on("hide.bs.modal", function(t) {
                o("body").find("#" + a).remove()
            }),
        e.isbtnok || i.find(".ok").hide(),
        e.isbtncl || i.find(".cancel").hide(),
            a
    }
    var n, s;
    window.Ewin = (n = '<div id="[Id]" class="modal fade" role="dialog" aria-labelledby="modalLabel"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button><h4 class="modal-title" id="modalLabel">[Title]</h4></div><div class="modal-body"><p>[Message]</p></div><div class="modal-footer"><button type="button" class="btn btn-default cancel" data-dismiss="modal">[BtnCancel]</button><button type="button" class="btn btn-success ok" data-dismiss="modal">[BtnOk]</button></div></div></div></div>',
        s = new RegExp("\\[([^\\[\\]]*?)\\]","igm"),
        {
            alert: function(t) {
                "string" == typeof t && (t = {
                    message: t
                });
                var i = a(t)
                    , e = o("#" + i);
                return e.find(".ok").removeClass("btn-success").addClass("btn-primary"),
                    e.find(".cancel").hide(),
                    {
                        id: i,
                        on: function(t) {
                            t && t instanceof Function && e.find(".ok").click(function() {
                                t(!0)
                            })
                        },
                        hide: function(i) {
                            i && i instanceof Function && e.on("hide.bs.modal", function(t) {
                                i(t)
                            })
                        }
                    }
            },
            confirm: function(t) {
                var i = a(t)
                    , e = o("#" + i);
                return e.find(".ok").removeClass("btn-primary").addClass("btn-success"),
                    e.find(".cancel").show(),
                    {
                        id: i,
                        on: function(t) {
                            t && t instanceof Function && (e.find(".ok").click(function() {
                                t(!0)
                            }),
                                e.find(".cancel").click(function() {
                                    t(!1)
                                }))
                        },
                        hide: function(i) {
                            i && i instanceof Function && e.on("hide.bs.modal", function(t) {
                                i(t)
                            })
                        }
                    }
            },
            dialog: function(t) {
                var i = a(t)
                    , e = o("#" + i);
                return e.find(".modal-dialog").removeClass("modal-sm"),
                    t.url ? e.find(".modal-body").load(t.url) : e.find(".modal-body").html(t.message),
                    {
                        id: i,
                        on: function(t) {
                            t && t instanceof Function && (e.find(".ok").click(function() {
                                t(!0)
                            }),
                                e.find(".cancel").click(function() {
                                    t(!1)
                                }),
                                e.find(".close").click(function() {
                                    t(!1)
                                }))
                        },
                        hide: function(i) {
                            i && i instanceof Function && e.on("hide.bs.modal", function(t) {
                                i(t)
                            })
                        }
                    }
            }
        })
}(jQuery);
var leftMenu = function() {
    var t = ["menu-user", "menu-xstg", "menu-msgpush", "menu-order-income", "menu-wxset"];
    this.init = function() {
        $("#sidebar-nav a[data-toggle='collapse']").bind("click", function(t) {
            t.preventDefault(),
                t.stopPropagation();
            var i = $(this).attr("id");
            $(this).hasClass("collapsed") ? ($(this).removeClass("collapsed"),
                $(this).next().slideUp(),
                Cookies.set(i, "0", {
                    expires: 31536e4
                })) : ($(this).addClass("collapsed"),
                $(this).next().slideDown(),
                Cookies.set(i, "1", {
                    expires: 31536e4
                }))
        }),
            $.each(t, function(t, i) {
                "0" == Cookies.get(i) ? ($("#" + i).removeClass("collapsed"),
                    $("#" + i).next().hide()) : ($("#" + i).addClass("collapsed"),
                    $("#" + i).next().show())
            }),
            $("#sidebar-scroll-menu").show()
    }
};
